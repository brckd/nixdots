name: "Push to Cachix"

on:
  push:

jobs:
  cache_nixos:
    runs-on: ubuntu-latest
    steps:
      - name: Clone repository
        uses: actions/checkout@v4
      - name: Install Nix
        uses: DeterminateSystems/nix-installer-action@main
      - name: Build NixOS configuration for desktop
        run: >
          nix run github:brckd/nix-fast-build --
          --no-nom --cachix-cache nixdots
          --flake ".#legacyPackages.x86_64-linux.nixosConfigurations.desktop.config.system.build.toplevel"
        env:
          CACHIX_AUTH_TOKEN: "${{ secrets.CACHIX_AUTH_TOKEN }}"

  cache_home:
    runs-on: ubuntu-latest
    steps:
      - name: Clone repository
        uses: actions/checkout@v4
      - name: Install Nix
        uses: DeterminateSystems/nix-installer-action@main
      - name: Build Home Manager configuration for Bricked
        run: >
          nix run github:brckd/nix-fast-build --
          --no-nom --cachix-cache nixdots
          --flake ".#legacyPackages.x86_64-linux.homeConfigurations.bricked.activationPackage"
        env:
          CACHIX_AUTH_TOKEN: "${{ secrets.CACHIX_AUTH_TOKEN }}"

  cache_droid:
    runs-on: ubuntu-latest
    steps:
      - name: Clone repository
        uses: actions/checkout@v4
      - name: Install Nix
        uses: DeterminateSystems/nix-installer-action@main
      - name: Build nix-on-droid configuration
        run: >
          nix run github:brckd/nix-fast-build --
          --no-nom --cachix-cache nixdots
          --flake ".#legacyPackages.aarch64-linux.nixOnDroidConfigurations.phone.activationPackage"
        env:
          CACHIX_AUTH_TOKEN: "${{ secrets.CACHIX_AUTH_TOKEN }}"
